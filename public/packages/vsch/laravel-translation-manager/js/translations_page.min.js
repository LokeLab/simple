var CLIP_TEXT,YANDEX_TRANSLATOR_KEY,URL_YANDEX_TRANSLATOR_KEY,PRIMARY_LOCALE,CURRENT_LOCALE,TRANSLATING_LOCALE,URL_TRANSLATOR_GROUP,URL_TRANSLATOR_ALL,xtranslateText,xtranslateService;jQuery(document).ready(function($){function t(t,e){t.find("tr").each(function(){if(!$(this).hasClass("hidden")){var t=$(this).find("td.key").first();if(t.length>0){var n=t[0].innerText;e.exec(n)||$(this).addClass("hidden")}}})}function e(){var t=$("#translations");t.find("tr").removeClass("hidden")}function n(){var e=$("#translations").find("tbody").first(),n=$("#show-matching-text"),a,i,s,r,o;if(i=e.find("tr").length,l(),r=s=i-e.find("tr.hidden").length,n.length>0){var d=n[0].value.trim();a=new RegExp(d,"i"),t(e,a),r=i-e.find("tr.hidden").length}if(o=$("#key-filter").first(),o.length>0){var c="";r!==s&&(c+=r+"/"),s!==i&&(c+=s+"/"),c+=i,o.removeClass("have-filtered"),r!==i&&o.addClass("have-filtered"),o[0].innerHTML=c}}function a(t,e,n){if(t.length){var a,i,s=e.text(),r=e.data("disable-with");a=t.length,i=0;var l,o=function(t){n(t.srcText,function(n,a){if(""!==n){var i=$.ajax({type:"POST",url:t.dataUrl,data:{name:t.dataName,value:n},success:function(a){"ok"===a.status?(t.dstElem.removeClass("editable-empty status-0"),t.dstElem.addClass("status-1"),t.dstElem.text(n),t.dstElem.editable("setValue",n,!1)):(e.removeAttr("disabled"),e.text(s))},encode:!0});i.done(function(){l()}),i.fail(function(){e.removeAttr("disabled"),e.text(s)})}else e.removeAttr("disabled"),e.text(s)})};l=function(){t.length?(i++,o(t.pop()),e.attr("disabled","disabled"),e.text(r+" "+i+" / "+a)):(e.removeAttr("disabled"),e.text(s))};for(var d=0;5>d;d++)l()}}function i(t,e,n){return function(){var a={id:null},i={id:null},s=function(t,e,n){return function(){"both"===e.css("resize")?(e.outerWidth(t.outerWidth()),e.outerHeight(t.outerHeight())):"horizontal"===e.css("resize")?e.outerWidth(t.outerWidth()):"vertical"===e.css("resize")&&e.outerHeight(t.outerHeight()),n.id&&(clearTimeout(n.id),n.id=null)}};n&&$(window).on("mousemove",function(n){n.target===t[0]?(a.id&&(clearTimeout(a.id),a.id=null),a.id=setTimeout(s(t,e,a),1e3/30)):n.target===e[0]&&(i.id&&(clearTimeout(i.id),i.id=null),i.id=setTimeout(s(e,t,i),1e3/30))}),$(window).on("mouseup",function(n){null!==a.id&&(clearTimeout(a.id),a.id=null),n.target===t[0]?s(t,e,a)():n.target===e[0]&&s(e,t,i)()})}}$(".group-select").on("change",function(){var t=$(this).val();t?window.location.href=URL_TRANSLATOR_GROUP+$(this).val():window.location.href=URL_TRANSLATOR_ALL}),$("a.delete-key").on("ajax:success",function(t,e){var n=$(this).closest("tr");n.addClass("deleted-translation"),$(this).addClass("hidden"),n.find("a.undelete-key").first().removeClass("hidden")}),$("a.undelete-key").on("ajax:success",function(t,e){var n=$(this).closest("tr");n.removeClass("deleted-translation"),$(this).addClass("hidden"),n.find("a.delete-key").first().removeClass("hidden")});var s=function(t){var e=$("div.success-"+t),n=e.html();$(".form-"+t).on("ajax:success",function(t,a){e.html(n.replace(/:count\b/,a.counter)),e.closest("div.alert").slideDown()})};s("import-group"),s("import-all"),s("find"),$(".form-publish-group").on("ajax:success",function(t,e){if("errors"===e.status){var n=$("div.errors-alert"),a=e.errors;n.html("<p>"+a.join("</p>\n<p>")+"</p>\n"),n.closest("div.alert").slideDown()}else $("div.success-publish").closest("div.alert").slideDown(),$("tr.deleted-translation").remove()}),$(".form-publish-all").on("ajax:success",function(t,e){if("errors"===e.status){var n=$("div.errors-alert"),a=e.errors;n.html("<p>"+a.join("</p>\n<p>")+"</p>\n"),n.closest("div.alert").slideDown()}else $("div.success-publish-all").closest("div.alert").slideDown(),$("tr.deleted-translation").remove()}),$("#form-keyops").on("ajax:success",function(t,e){var n=$("#wildcard-keyops-results").first();n.html(e),n.find(".vsch_editable").vsch_editable()});var r=$("#searchModal").first();r.on("shown.bs.modal",function(t,e,n,a){r.find("#search-form-text").first().focus()}),r.on("ajax:success",function(t,e,n,a){var i=r.find(".results");i.html(e),i.find(".vsch_editable").vsch_editable()}),$("#translate-current-primary").on("click",function(){var t=$("#current-text").first(),e=t[0].value;xtranslateService(TRANSLATING_LOCALE,e,PRIMARY_LOCALE,function(t){var e=$("#primary-text").first();e.length&&e.val(t)})}),$("#translate-primary-current").on("click",function(){var t=$("#primary-text").first(),e=t[0].value;xtranslateService(PRIMARY_LOCALE,e,TRANSLATING_LOCALE,function(t){var e=$("#current-text").first();e.length&&e.val(t)})}),$("#db-connection").on("change",function(){$("#form-interface-locale")[0].submit()}),$("#interface-locale").on("change",function(){$("#form-interface-locale")[0].submit()}),$("#translating-locale").on("change",function(){$("#form-interface-locale")[0].submit()}),$("#primary-locale").on("change",function(){$("#form-interface-locale")[0].submit()}),$("#display-locale-all").on("click",function(t){t.preventDefault(),$(".display-locale").prop("checked",!0)}),$("#display-locale-none").on("click",function(t){t.preventDefault(),$(".display-locale").prop("checked",!1)});var l=e;$("#show-all").on("click",function(t){l=e,n()}),$("#show-unpublished").on("click",function(t){l=function(){var t=$("#translations").find("tbody").first();t.find("tr").addClass("hidden"),t.find("tr.has-empty-translation").removeClass("hidden"),t.find("tr.deleted-translation").removeClass("hidden"),t.find("tr.has-changed-translation").removeClass("hidden")},n()}),$("#show-empty").on("click",function(t){l=function(){var t=$("#translations").find("tbody").first();t.find("tr").addClass("hidden"),t.find("tr.has-empty-translation").removeClass("hidden")},n()}),$("#show-nonempty").on("click",function(t){l=function(){var t=$("#translations").find("tbody").first();t.find("tr").addClass("hidden"),t.find("tr.has-nonempty-translation").removeClass("hidden")},n()}),$("#show-used").on("click",function(t){l=function(){var t=$("#translations").find("tbody").first();t.find("tr").addClass("hidden"),t.find("tr.has-used-translation").removeClass("hidden")},n()}),$("#show-deleted").on("click",function(t){l=function(){var t=$("#translations").find("tbody").first();t.find("tr").addClass("hidden"),t.find("tr.deleted-translation").removeClass("hidden")},n()}),$("#show-changed").on("click",function(t){l=function(){var t=$("#translations").find("tbody").first();t.find("tr").addClass("hidden"),t.find("tr.has-changed-translation").removeClass("hidden")},n()});var o=null,d=$("#show-matching-text");d.on("keyup change",function(){o&&(window.clearTimeout(o),o=null),o=window.setTimeout(function(){o=null,n()},100)}),$("#show-matching-clear").on("click",function(){d.length&&(d[0].value="",d.focus(),n())}),$("div.alert-dismissible").each(function(){var t=$(this),e=t.find("button.close").first();e.length&&e.on("click",function(){t.slideUp()})});var c=$(".btn.auto-translate");c.each(function(){var t=$(this).data("trans"),e=$(this).data("locale"),n=$(this);n.on("click",function(i){i.preventDefault(),i.stopPropagation();var s=[];$(".auto-translatable-"+e).each(function(){var e=$(this).parent().find(".vsch_editable");if(e.length>1){var n=$(e[0]),a=$(e[t]);a.length&&n.length&&a.hasClass("editable-empty")&&!n.hasClass("editable-empty")&&s.push({srcText:n.text(),dataUrl:a.data("url"),dataName:a.data("name"),dstElem:a})}}),function(t,e,n){a(s,n,function(n,a){xtranslateText(xtranslateService,t,n,e,a)})}(PRIMARY_LOCALE,e,n)})});var f=$("#auto-fill");f.on("click",function(t){var e=[];t.preventDefault(),t.stopPropagation(),$(".auto-fillable").each(function(){var t=$(this).find("a.vsch_editable.editable-empty");t.length&&e.push({srcText:t.data("name").substr(PRIMARY_LOCALE.length+1),dataUrl:t.data("url"),dataName:t.data("name"),dstElem:t})}),function(t){a(e,t,function(t,e){var n=/^.*\.|-|_/g,a=t.replace(n," ").toCapitalCase().trim();e(a,"")})}(f)});var u=$("#form-addkeys").first();i(u.find("textarea[name=keys]"),u.find("textarea[name=suffixes]"),!0)(),i($("#primary-text"),$("#current-text"),!0)(),i($("#srckeys"),$("#dstkeys"),!0)()});